# 秒杀专题

## 什么是秒杀

短时间（瞬时），大量请求，买一个（数量少）商品。



解决：高并发（读，写）



## 秒杀系统目标

稳：高可用，系统稳定的提供服务。



准：超卖。数据一致性问题。



快：高性能。（优化的点）



# 架构原则：

## 	减少用户和服务端的交互

​	数据要少：请求参数和相应参数要少，降低对网络的占用，降低对cpu的消耗，对IO数据库（非必要的信息）

​	请求数要少：合并请求

​	路径要短：路径越长风险越大

​	依赖要少：花里胡哨的减少，优先级高的展示，低的去掉。

​	不要单点：保证高可用：负载均衡，水平扩展。（relicate:数字（K8s中的例子））docker image（服务+DB volume）

# 动静数据分离

数据区分：url,用户，浏览的时间，地域，cookie(缓存信息)-> 静态数据，cdn,负载均衡

url（商品详情），url1 : 详情 （json）

放到离用户最近的地方，cdn （浏览器缓存，服务器缓存guava cache, map，redis，文件缓存等）



CSI (Client side include) : 局部刷新， 其实就是 iframe ajax

浏览器： 合并请求，缓存数据

1. 用户
2. 浏览器
3. DNS
4. CDN
5. 负载均衡
6. 网关 zuul
7. 服务
8. IO

# 热点数据

本来 卖衣服秒杀，系统都为衣服服务，结果 水果



## 识别热点

监控，追踪。用户访问，添加购物车，下单，统计分析（经验，BI）。

发现热点数据：分析日志，添加 队列，系统订阅。

# LRU算法

双向哈希链表

队列分桶

Hash取回

定向流量转发 用hash

1. 限流与削峰

   限流只接收限流内的流量，超出流量直接拒绝

   削峰可能只能接收10个请求，但是当100个请求都过来的时候，也可以请求。



小流量的请求：锁、queue、序列化（存表，使用serializeable将bean转化为文件）

压力测试需要找到拐点



ECTD

分布式事务里面的分布式ID需要用到分布式锁



